{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":";;AAAA,mCAAmC;AAEnC,mCAA2F;AAC3F,mGAAmG;AACnG,mCAA0C;AAE1C,yCAA4C;AAC5C,MAAM,QAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AACrC,MAAM,GAAG,GAAG,CAAC,OAAe,EAAE,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,uBAAe,CAAC,OAAO,CAAC,CAAC,CAAC;AAEvE,MAAM,GAAG,GAAG,OAAO,EAAE,CAAC;AACtB,MAAM,MAAM,GAAG;IACb,OAAO,EAAE;QACP,OAAO,EAAE,YAAS,CAAS,iBAAiB,CAAC;QAC7C,SAAS,EAAE,YAAS,CAAS,mBAAmB,CAAC;QACjD,KAAK,EAAE,YAAS,CAAS,eAAe,CAAC;KAC1C;IACD,sBAAsB,EAAE,YAAS,CAAS,wBAAwB,CAAC;CACpE,CAAC;AAEF,OAAO,CAAC,EAAE,CAAC,oBAAoB,EAAE,CAAC,MAAM,EAAE,QAAQ,EAAE,EAAE;IACpD,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;AACxB,CAAC,CAAC,CAAC;AACH,MAAM,IAAI;IACR,KAAK,CAAC,IAAI;QACR,GAAG,CAAC,GAAG,CAAC,CAAC,OAAwB,EAAE,SAA2B,EAAE,IAAI,EAAE,EAAE;YACtE,wBAAgB,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE;gBACjC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;YACrC,CAAC,CAAC,CAAC;YACH,IAAI,EAAE,CAAC;QACT,CAAC,CAAC,CAAA;QACF;;;;;;;;;;QAUA;QACA,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,OAAO,CAAC,SAAS,EAAE,KAAK,EAAE,OAAwB,EAAE,QAA0B,EAAE,EAAE;YAC/F,MAAM,KAAK,GAAG,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,EAAE,CAAA;YAC/C,IAAI,KAAK,KAAK,MAAM,CAAC,OAAO,CAAC,KAAK,EAAE;gBAClC,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,CAAC;gBAC3B,OAAO;aACR;YACD,yBAAc,CAAC,sBAAsB,CAAC,MAAM,CAAC,sBAAsB,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE;gBACvF,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,WAAW,CAAC,kBAAkB,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,GAAG,EAAE,CAAC;YAChF,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,GAAQ,EAAE,EAAE;gBACpB,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YACnB,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QACH,GAAG,CAAC,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,EAAE,GAAG,EAAE;YACtC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAA;YACpB,GAAG,CAAC,qBAAqB,MAAM,CAAC,OAAO,CAAC,OAAO,GAAG,MAAM,CAAC,OAAO,CAAC,SAAS,EAAE,CAAC,CAAC;YAC9E,sBAAc,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE;gBACjC,GAAG,CAAC,WAAW,OAAO,IAAI,MAAM,CAAC,OAAO,CAAC,OAAO,GAAG,MAAM,CAAC,OAAO,CAAC,SAAS,EAAE,CAAC,CAAC;YACjF,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC;CACF;AACD,IAAI,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC","sourcesContent":["import * as express from \"express\";\r\nimport { posix } from \"path\";\r\nimport { mergeDateformat, getIpv4Address, requestから接続情報を取得, slackにメッセージ投稿 } from \"./utils\";\r\n// configで読み込むファイル名はこちら。値のマージも可能。 https://github.com/lorenwest/node-config/wiki/Configuration-Files\r\nimport { get as configGet } from \"config\";\r\nimport { sprintf } from \"sprintf-js\";\r\nimport { EvernoteClient } from \"./evernote\";\r\nconst Evernote = require('evernote');\r\nconst log = (message: string) => console.log(mergeDateformat(message));\r\n\r\nconst app = express();\r\nconst config = {\r\n  express: {\r\n    urlPort: configGet<number>(\"express.urlPort\"),\r\n    urlPrefix: configGet<string>(\"express.urlPrefix\"),\r\n    token: configGet<string>(\"express.token\"),\r\n  },\r\n  evernoteDeveloperToken: configGet<string>(\"evernoteDeveloperToken\")\r\n};\r\n\r\nprocess.on('unhandledRejection', (reason, _promise) => {\r\n  console.error(reason);\r\n});\r\nclass Main {\r\n  async init() {\r\n    app.use((request: express.Request, _response: express.Response, next) => {\r\n      requestから接続情報を取得(request).then(a => {\r\n        log(JSON.stringify(a, null, \"  \"));\r\n      });\r\n      next();\r\n    })\r\n    /**\r\n  * リクエストデータを取得する方法\r\n  *   app.get の中で:keywordId の様に指定したキーワードの値\r\n  *     request.params.keywordId\r\n  *   getパラメーターの中で指定された値\r\n  *     request.query.keywordId\r\n  *   postパラメーターの中で指定された値\r\n  *     request.body.column\r\n  *   POSTでパラメータを受信する方法。ヘッダーが大事\r\n  *     await fetch(\"http://127.0.0.1:51919/test/yyyy\",{method:\"post\",body:\"hoge=aaaaaaaaaaaaaa\",headers:{\"Content-Type\":\"application/x-www-form-urlencoded\"}})\r\n  */\r\n    app.get(config.express.urlPrefix, async (request: express.Request, response: express.Response) => {\r\n      const token = String(request.query.token) || \"\"\r\n      if (token !== config.express.token) {\r\n        response.status(403).end();\r\n        return;\r\n      }\r\n      EvernoteClient.getEvernoteAllNoteData(config.evernoteDeveloperToken).then(noteBookList => {\r\n        response.status(200).contentType(\"application/json\").json(noteBookList).end();\r\n      }).catch((err: any) => {\r\n        console.log(err);\r\n      });\r\n    });\r\n    app.listen(config.express.urlPort, () => {\r\n      console.log(\"ready\")\r\n      log(` http://localhost:${config.express.urlPort}${config.express.urlPrefix}`);\r\n      getIpv4Address().forEach(address => {\r\n        log(` http://${address}:${config.express.urlPort}${config.express.urlPrefix}`);\r\n      });\r\n    });\r\n  }\r\n}\r\nnew Main().init();\r\n"]}